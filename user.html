<html>

<head>

    <meta charset="utf-8">
    <meta name="A-Token" content="${localStorage.getItem('A-Token')}" />
    <title id="title"></title>
    <link rel="icon" type="image/icon" href="img/faviconPng.ico">
    <!-- Bootstrap -->
    <link href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/userStyle.css">
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>

    <script type="text/javascript">
        //        document.ondragstart = noselect;
        //        // запрет на перетаскивание 
        //        document.onselectstart = noselect;
        //        // запрет на выделение элементов страницы 
        //        document.oncontextmenu = noselect;
        //        // запрет на выведение контекстного меню 
        //        function noselect() {
        //            return false;
        //        }

    </script>

</head>

<style>
    * {

        font-family: ubuntu;
    }

    body {
        font-size: 13px;
    }

    .navbar-default .navbar-nav>li>a {
        color: whitesmoke;
    }

    .navbar-default .navbar-nav>li>a:hover {
        color: #162449;
        background: whitesmoke;
    }

    .navbar-default .navbar-toggle:hover {
        background-color: transparent;
        color: whitesmoke;

    }

    .navbar-default .navbar-toggle {
        border: none;
    }

    button.navbar-toggle.collapsed.glyphicon.glyphicon-menu-hamburger {
        color: whitesmoke;
    }

    button.navbar-toggle.collapsed.glyphicon.glyphicon-menu-hamburger:focus {
        color: whitesmoke;
        background-color: transparent;
    }

    container {
        padding-left: 0px;
        padding-right: 0px;
        width: 100%;
    }

</style>

<body>

    <div class="container-fluid" style="padding-left: 0;padding-right: 0">
        <header>
            <nav class="navbar navbar-static-top">
                <div style="background-color: #4d75a3;">
<!--
                        border-radius: 73px;
                        border-top-left-radius: 70px;
                        border-top-right-radius: 70px;
                        border-bottom-right-radius: 70px;
                        border-bottom-left-radius: 70px;">
-->
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle navbar-toggle-sidebar collapsed" id="myMethod">Меню</button>
                        <a class="navbar-brand" href="user.html">
				        <img src="img/IndexLogo.png" style="max-width: 115px;">
				        </a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <form class="navbar-form navbar-right">
                            <!--
                            <div class="form-group">
                                <input type="text" name="q" class="form-control" placeholder="Search">
                            </div>
                            <button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
-->
                        </form>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </nav>
        </header>
    </div>
    <div class="container" style="">
        <main>

            <div class="col-sm-1 col-md-2 col-lg-2">
                <div class="row">
                    <!-- uncomment code for absolute positioning tweek see top comment in css -->
                    <!-- Menu -->
                    <div class="side-menu">
                        <nav class="navbar navbar-default" role="navigation">
                            <!-- Main Menu -->
                            <div class="side-menu-container">
                                <ul class="nav navbar-nav">
                                    <li class="active"><a href="user.html"><span class="glyphicon glyphicon-home"></span> Моя сторінка</a></li>
                                    <li class="active"><a href="#"><span class="glyphicon glyphicon-comment"></span> Новини</a></li>
                                    <li class="active"><a href="dialog.html"><span class="glyphicon glyphicon-envelope"></span> Повідомлення<span class="badge" id="message-incoming" style="margin-left: 5px"></span></a></li>
                                    <li class="active"><a href="edit_my_informations.html"><span class="glyphicon glyphicon-wrench"></span> Налаштування</a></li>
                                    <li class="active"><a href="search.html"><span class="glyphicon glyphicon-search"></span> Пошук</a></li>
                                    <li class="active" id="log-out"><a href="index.html"><span class="glyphicon glyphicon-log-out"></span> Вихід</a></li>
                                </ul>
                            </div>
                            <!-- /.navbar-collapse -->
                        </nav>

                    </div>


                </div>
            </div>

            <!--            /////////display-->
            <!--            <div class="col-sm-2 col-md-2 col-lg-2">-->


            <div class="container-fluid">
                <div class="row profile">
                    <div class="col-md-3">
                        <div class="profile-sidebar">
                            <!-- SIDEBAR USER TITLE -->
                            <div class="profile-usertitle" style="margin-top: 0px;">
                                <div class="profile-usertitle-name" id="full-name">

                                </div>
                            </div>
                            <!-- END SIDEBAR USER TITLE -->
                            <!-- SIDEBAR USERPIC -->
                            <div class="profile-userpic" style="margin-right: 5px;margin-left: 5px;">
                                <img src="" class="img-responsive center-block text-center" id="user-photo" alt="">
                            </div>
                            <!-- END SIDEBAR USERPIC -->
                            <div class="profile-usertitle-job" id="credo">

                            </div>
                            <!-- SIDEBAR BUTTONS -->
                            <ul class="nav navbar-nav2" id="upload-new-photo">
                                <li class="dropdown" style="border-top: 25px solid #F1F3FA">
                                    <a href="edit_my_informations.html" class="dropdown-toggle" role="button" data-toggle="modal" id="modal-photo-upload-form-button">Завантажити нове фото <span class="glyphicon glyphicon-camera pull-right"></span></a>
                                </li>
                            </ul>


                            <ul class="nav navbar-nav2" id="send-message-and-friend">
                                <li class="dropdown" style="border-top: 25px solid #F1F3FA">
                                    <a onclick="sendMessage(value)" class="dropdown-toggle" data-toggle="dropdown" id="send-message-button" value="" style="cursor: pointer">Надіслати повідомлення <span class="glyphicon glyphicon-envelope pull-right"></span></a>
                                    <a class="dropdown-toggle" data-toggle="dropdown" style="cursor: pointer">Додати до друзів <span class="glyphicon glyphicon-user pull-right" ></span></a>

                                </li>
                            </ul>

                            <!-- END SIDEBAR BUTTONS -->

                        </div>
                    </div>

                    <div class="container-fluid">
                        <div class="col-lg-4 col-md-4 col-sm-12 content-block" style="padding-top: 1px">
                            <div class="profile-content">
                                <div class="sort-information-style" style="padding-bottom: 20px;">
                                    <h5>Головна інформація</h5>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12">

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Країна:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="coutry"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Місто:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="city"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Дата реєстрації:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="date-of-registration"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Дата народження:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="date-of-birth"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Сімейний стан:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="marital-status"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Мова:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="language"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-content">
                                <div class="sort-information-style" style="padding-bottom: 20px;">
                                    <h5>Освіта</h5>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12">

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Школа:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="school"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>ВНЗ:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="university"></p>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="profile-content">
                                <div class="sort-information-style" style="padding-bottom: 20px;">
                                    <h5>Контакти</h5>
                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12">

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Email:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="users-email"></p>
                                        </div>
                                    </div>

                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 inform">
                                        <div class="col-lg-6 col-md-6 left-info">
                                            <p>Мобільний:</p>
                                        </div>
                                        <div class="col-lg-6 col-md-6 right-info">
                                            <p id="phone-number"></p>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>

                        <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                            <div class="profile-content">
                                <div class="sort-information-style">
                                    <h5>Фотострічка</h5>
                                    <div class="col-lg-6 col-md-6 photos">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                    </div>
                                    <div class="col-lg-6 col-md-6 photos">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">
                                        <img src="img/noprofile_lg.gif" class="img-responsive img-thumbnail text-center right-img-list">

                                    </div>
                                </div>

                            </div>
                            <div class="profile-content" style="padding-bottom: 0">
                                <ul class="nav navbar-nav2">
                                    <li class="dropdown" style="border-top: 25px solid #F1F3FA">
                                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Показати всі фотографії<span class="glyphicon glyphicon-picture pull-right"></span></a>

                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>


            </div>


        </main>
        

        <footer class="pull-left footer" style="text-align: center">
            <p class="col-md-12">
                <hr class="divider"> Copyright &COPY; 2018 <a href="#">HiPasserby</a>
        </footer>
        

    </div>

    <script>
        var user;

        $.ajax({
            "url": "http://localhost:8080/login",
            'method': 'GET',
            'contentType': 'application/json',
            'dataType': 'json',
            'async': false,
            'headers': {
                'A-Token': localStorage.getItem('A-Token'),
                'Content-Type': 'application/json;charset=utf-8'
            },
            'success': function(data) {
                user = data;
            },
        });

        console.log(user);


        var pageHref = location;
        //перетворюємо в стрічку
        var stroka = pageHref.toString();

        //шукаємо символ підходящого "id="    
        // вирізаємо все після цього символу




        var result = stroka.slice(stroka.search(/id=/) + 3);

        $('#send-message-button').val(result)


        var findOneByIdRequest = {
            'id': result
        }
        $.ajax({
            "url": "http://localhost:8080/user",
            'method': 'POST',
            'contentType': 'application/json',
            'dataType': 'json',
            'data': JSON.stringify(findOneByIdRequest),
            'headers': {
                'A-Token': localStorage.getItem('A-Token'),
                'Content-Type': 'application/json;charset=utf-8'
            },
            'success': function(data) {
                if (data.id == user.id) {
                    $("#send-message-and-friend").hide();
                } else {
                    $("#upload-new-photo").hide();
                }
                $('#title').append(data.firstName + " " + data.lastName);
                $('#full-name').append(data.firstName + " " + data.lastName);
                $('#coutry').append(data.country);
                $('#city').append(data.city);
                $('#date-of-registration').append(data.dateOfRegistration);
                $('#date-of-birth').append(data.dayOfBirth + "/" + data.monthOfBirth + "/" + data.yearOfBirth);
                $('#marital-status').append(data.maritalStatus);
                $('#language').append(data.language);
                $('#school').append(data.school);
                $('#university').append(data.university);
                $('#users-email').append(data.email);
                $('#phone-number').append(data.phoneNumber);
                $('#credo').append(data.credo);
                $("#user-photo").attr("src", 'http://localhost:8080' + data.photo);

            },
            'error': function(error) {
                getUser();
            }
        });
        
        $(function() {

            $.ajax({
                "url": "http://localhost:8080/dialog/notification",
                'method': 'GET',
                'contentType': 'application/json',
                'dataType': 'json',
                'headers': {
                    'A-Token': localStorage.getItem('A-Token'),
                    'Content-Type': 'application/json;charset=utf-8'
                },
                'success': function(data) {
                    //                    var count = $('#message-incoming').val();
                    if (data > 0) {
                        $('#message-incoming').append(data);
                        $('#title').prepend("(" + data + ")");
                    }
                },
                'error': function(error) {
                    console.log(error);
                }
            });
        });



        function getUser() {

            $.ajax({
                "url": "http://localhost:8080/login",
                'method': 'GET',
                'contentType': 'application/json',
                'dataType': 'json',
                'headers': {
                    'A-Token': localStorage.getItem('A-Token'),
                    'Content-Type': 'application/json;charset=utf-8'
                },
                'success': function(data) {
                    $("#send-message-and-friend").hide();
                    $('#title').append(data.firstName + " " + data.lastName);
                    $('#full-name').append(data.firstName + " " + data.lastName);
                    $('#coutry').append(data.country);
                    $('#city').append(data.city);
                    $('#date-of-registration').append(data.dateOfRegistration);
                    $('#date-of-birth').append(data.dayOfBirth + "/" + data.monthOfBirth + "/" + data.yearOfBirth);
                    $('#marital-status').append(data.maritalStatus);
                    $('#language').append(data.language);
                    $('#school').append(data.school);
                    $('#university').append(data.university);
                    $('#users-email').append(data.email);
                    $('#phone-number').append(data.phoneNumber);
                    $('#credo').append(data.credo);
                    $("#user-photo").attr("src", 'http://localhost:8080' + data.photo);
                },
                'error': function(error) {
                    document.location.href = 'index.html';
                }
            });

        }


        function sendMessage(Object) {
            var findOneByIdRequest = {
                'id': Object
            }
            $.ajax({
                "url": "http://localhost:8080/dialog/return_dialog",
                'method': 'POST',
                'contentType': 'application/json',
                'dataType': 'json',
                'data': JSON.stringify(findOneByIdRequest),
                'headers': {
                    'A-Token': localStorage.getItem('A-Token'),
                    'Content-Type': 'application/json;charset=utf-8'
                },
                'success': function(data) {
                    document.location = "message.html?id=" + data;
                    console.log(data);
                    console.log("ВИКОНАВСЯ SUCCESS");

                },
                'error': function(error) {
                    console.log(error);
                    console.log("ВИКОНАВСЯ ЕРРРОР");
//                    document.location = "message.html?id=0"
                }
            });
        }



        $('#edit-photo-button').click(function() {

        });


        $('#log-out').click(function() {
            localStorage.removeItem('A-Token');
            document.location.href = 'activation.html';
        });





        $(window).resize(function() {
            var width = $(window).width();
            if (width < 1200) {
                $("#myMethod").collapse('hide');
            }
        });


        $(function() {
            $('.navbar-toggle-sidebar').click(function() {
                $('.navbar-nav').toggleClass('slide-in');
                $('.side-body').toggleClass('body-slide-in');
                $('#search').removeClass('in').addClass('collapse').slideUp(200);
            });




            $('#search-trigger').click(function() {
                $('.navbar-nav').removeClass('slide-in');
                $('.side-body').removeClass('body-slide-in');
                $('.search-input').focus();
            });
        });

    </script>

</body>

</html>
